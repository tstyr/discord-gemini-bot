╔════════════════════════════════════════════════════════════╗
║                                                            ║
║          🎵 音楽再生エラー - クイック修正手順 🎵          ║
║                                                            ║
╚════════════════════════════════════════════════════════════╝

【問題】
❌ 曲が見つからない
❌ URLでも再生失敗
❌ すべての音楽が動かない

【原因】
YouTube署名暗号化の更新により、Lavalinkが対応できなくなった

【修正（3ステップ）】

┌────────────────────────────────────────────────────────────┐
│ ステップ1: 設定チェック                                    │
└────────────────────────────────────────────────────────────┘

  コマンド:
    python check_music_setup.py

  確認項目:
    ✅ 環境変数
    ✅ Lavalinkファイル
    ✅ Lavalink設定
    ✅ Bot依存関係
    ✅ Lavalink接続

┌────────────────────────────────────────────────────────────┐
│ ステップ2: Lavalink再起動                                  │
└────────────────────────────────────────────────────────────┘

  方法1（簡単）:
    restart_lavalink.bat をダブルクリック

  方法2（手動）:
    cd lavalink
    java -jar Lavalink.jar

  成功の確認:
    ログに "Lavalink is ready to accept connections." が表示

┌────────────────────────────────────────────────────────────┐
│ ステップ3: Bot起動                                         │
└────────────────────────────────────────────────────────────┘

  コマンド:
    python bot/main.py

  または:
    python start_bot.py

  成功の確認:
    ログに "✅ Connected to Lavalink server successfully"

【テスト】

  1. 日本語検索:
     「オーイシマサヨシ流して」

  2. URL入力:
     「https://www.youtube.com/watch?v=xxxxx 流して」

  3. スラッシュコマンド:
     /play query:YOASOBI アイドル

【よくあるエラーと解決策】

┌────────────────────────────────────────────────────────────┐
│ エラー: "曲が見つかりませんでした"                         │
└────────────────────────────────────────────────────────────┘

  原因: Lavalinkが起動していない
  解決: restart_lavalink.bat を実行

┌────────────────────────────────────────────────────────────┐
│ エラー: "Must find action functions"                       │
└────────────────────────────────────────────────────────────┘

  原因: Lavalinkが古い設定で動いている
  解決: 
    1. taskkill /F /IM java.exe
    2. restart_lavalink.bat

┌────────────────────────────────────────────────────────────┐
│ エラー: "Connection refused"                               │
└────────────────────────────────────────────────────────────┘

  原因: Lavalinkが起動していない
  解決: cd lavalink && java -jar Lavalink.jar

┌────────────────────────────────────────────────────────────┐
│ エラー: "401 Unauthorized"                                 │
└────────────────────────────────────────────────────────────┘

  原因: パスワードが間違っている
  解決: bot/.env の LAVALINK_PASSWORD を確認

【環境変数（bot/.env）】

  LAVALINK_HOST=localhost
  LAVALINK_PORT=2333
  LAVALINK_PASSWORD=youshallnotpass
  LAVALINK_SECURE=false

【修正内容の詳細】

  ファイル: lavalink/application.yml
  変更点:
    - ANDROID_TESTSUITE クライアントを追加
    - MEDIA_CONNECT クライアントを削除
    - YouTube旧ソースを無効化

【確認方法】

  ✅ Lavalinkログに "ready to accept connections"
  ✅ Botログに "Connected to Lavalink"
  ✅ 音楽検索で15件の結果が表示
  ✅ 曲が正常に再生される

【詳細ドキュメント】

  📄 音楽再生修正ガイド.md - 完全な修正手順
  📄 MUSIC_PLAYBACK_FIX.md - 技術的な詳細
  📄 HOW_TO_USE.md - 使い方ガイド

【サポート】

  問題が解決しない場合:
    1. python check_music_setup.py を実行
    2. lavalink/logs/spring.log を確認
    3. Botのコンソール出力を確認

╔════════════════════════════════════════════════════════════╗
║                                                            ║
║  🎉 修正完了後は音楽を楽しんでください！ 🎉               ║
║                                                            ║
╚════════════════════════════════════════════════════════════╝

最終更新: 2026-01-23
